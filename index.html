<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- META PWA CRÃTICOS -->
    <meta name="theme-color" content="#D4A017">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Control KilÃ³metros">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="COT">
    
    <!-- ÃCONOS APPLE -->
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-180.png">
    
    <!-- MANIFEST PWA -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- FONTAWESOME PARA ÃCONOS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- TU CSS -->
    <link rel="stylesheet" href="./style.css">
    
    <title>GestiÃ³n de Viajes</title>
    
    <style>
        /* ğŸ†• ESTILOS PARA LAS PANTALLAS NUEVAS */
        /* Tus estilos inline pueden quedarse aquÃ­ */
    </style>
    
    <!-- REGISTRO AUTOMÃTICO DEL SERVICE WORKER -->
    <script>
        // Registro del Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registrado con Ã©xito: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Error al registrar ServiceWorker: ', error);
                    });
            });
        }
        
        // Detectar si es standalone (app instalada)
        window.addEventListener('DOMContentLoaded', function() {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('App ejecutÃ¡ndose en modo standalone');
                document.body.classList.add('standalone-mode');
            }
        });
    </script>
</head>
<body>
    <!-- ğŸ†• PANTALLAS NUEVAS -->
    <div id="splashScreen" class="screen active">
        <div class="splash-container">
            <div class="splash-logo">ğŸšŒ</div>
            <h1>GestiÃ³n de Viajes</h1>
            <p>Cargando aplicaciÃ³n...</p>
        </div>
    </div>

    <div id="loginScreen" class="screen">
        <div class="login-container">
            <h2>ğŸ‘‹ Â¡Bienvenido!</h2>
            <input type="text" id="userNumber" placeholder="NÂº de Funcionario" maxlength="10">
            <input type="text" id="userName" placeholder="Nombre completo">
            <select id="userRole">
                <option value="conductor">Conductor</option>
                <option value="administrativo">Administrativo</option>
            </select>
            <button onclick="guardarUsuario()">Comenzar a Usar</button>
            <p class="note">* Estos datos se guardarÃ¡n localmente en tu dispositivo</p>
        </div>
    </div>

    <!-- =========================================== -->
    <!-- ğŸ¯ MAINSCREEN (SOLO BOTONES) - DENTRO DEL CONTAINER -->
    <!-- =========================================== -->
    <div class="container">
        <div id="mainScreen" class="screen active"> 
             <div class="main-screen-background"></div>
            <!-- LOGO -->
            <div class="logo-container">
                 <div class="app-logo"><i class="fas fa-bus"></i></div>
                <h1 class="app-title">GestiÃ³n de Viajes</h1>
                <p class="app-subtitle">Sistema de control de flota</p>
            </div>

           <!-- MENÃš DE BOTONES -->
           <div class="menu-container">
                <h2 class="title-section"> <i class="fas fa-compass"></i>Â¿QuÃ© deseas hacer?</h2>
                
                <div class="button-grid">
                    <button class="menu-btn primary" onclick="showScreen('travelScreen')">
                        <span class="btn-icon">ğŸš—</span>
                        <span class="btn-text">Nuevo Viaje</span>
                        <span class="btn-desc">Registrar nuevo viaje</span>
                    </button>

                    <button class="menu-btn secondary" onclick="showScreen('guardScreen')">
                        <span class="btn-icon">ğŸ›¡ï¸</span>
                        <span class="btn-text">Nueva Guardia</span>
                        <span class="btn-desc">Agregar turno de guardia</span>
                    </button>

                    <button class="menu-btn info" onclick="showScreen('travelListScreen')">
                        <span class="btn-icon">ğŸ“‹</span>
                        <span class="btn-text">Ver Viajes</span>
                        <span class="btn-desc">Lista de viajes registrados</span>
                    </button>

                    <button class="menu-btn warning" onclick="showScreen('guardListScreen')">
                        <span class="btn-icon">ğŸ‘¥</span>
                        <span class="btn-text">Ver Guardias</span>
                        <span class="btn-desc">Lista de guardias activas</span>
                    </button>
                    
                    <button class="menu-btn info" onclick="showScreen('semanaScreen')">
                        <span class="btn-icon">ğŸ“…</span>
                        <span class="btn-text">Mi Semana</span>
                        <span class="btn-desc">Resumen semanal de viajes</span>
                    </button>

                    <button class="menu-btn success" onclick="showScreen('reportsScreen')">
                        <span class="btn-icon">ğŸ“Š</span>
                        <span class="btn-text">Reportes</span>
                        <span class="btn-desc">EstadÃ­sticas y reportes</span>
                    </button>

                    <button class="menu-btn dark" onclick="showScreen('backupScreen')">
                        <span class="btn-icon">ğŸ’¾</span>
                        <span class="btn-text">Backup</span>
                        <span class="btn-desc">Exportar/importar datos</span>
                    </button>
                </div>
            </div>

            <!-- RESUMEN RÃPIDO -->
            <div class="quick-stats" style="display: none;">
                <div class="stat-item">
                    <span class="stat-number" id="totalTravels">0</span>
                    <span class="stat-label">Total Viajes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalKm">0</span>
                    <span class="stat-label">KM Totales</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalViaticos">0</span>
                    <span class="stat-label">ViÃ¡ticos</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalGuards">0</span>
                    <span class="stat-label">Guardias</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalGuardHours">0</span>
                    <span class="stat-label">Horas Guardia</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="todayTravels">0</span>
                    <span class="stat-label">Viajes Hoy</span>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================================== -->
    <!-- ğŸ¯ PANTALLAS MODALES - FUERA DEL CONTAINER -->
    <!-- =========================================== -->
    
    <!-- PANTALLA VIAJES (MODAL) -->
    <div id="travelScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸš— Nuevo Viaje</h2>
        </div>
       <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
    <button type="button" onclick="agregarDestinoManual()" class="btn-secondary">
        â• Agregar Nuevo Destino
    </button>

    <!-- Selector de fecha -->
    <input type="date" id="travelDate" class="input-date btn-secondary" />
</div>
        <div class="form-container">
            <!-- SELECTOR DE MODO -->
            <div class="mode-selector" style="margin-bottom: 20px;">
                <button type="button" id="btnRegular" class="mode-btn active" onclick="setMode('regular')">
                    ğŸšŒ SERVICIO REGULAR
                </button>
                <button type="button" id="btnContratado" class="mode-btn" onclick="setMode('contratado')">
                    ğŸ“ SERVICIO CONTRATADO
                </button>
            </div>

            <form id="travelFormDetailed" onsubmit="addTravel(event)">
                <!-- MODO REGULAR -->
                <div id="modoRegular">
                    <div class="form-group">
                        <label>ğŸ” Buscar Ruta Regular:</label>
                        <input type="text" id="buscarRuta" class="form-control" 
                               placeholder="Ej: Punta del Este, Colonia, Chuy..." 
                               oninput="buscarRutas(this.value)">
                        <div id="sugerenciasRutas" class="sugerencias-container"></div>
                    </div>

                    <div class="form-group">
                        <label>ğŸšŒ Servicio:</label>
                        <select id="numeroServicio" class="form-control" onchange="actualizarInfoServicio()">
                            <option value="">Primero elegÃ­ una ruta...</option>
                        </select>
                    </div>

                    <!-- INFO AUTOMÃTICA -->
                    <div id="infoAuto" class="info-auto" style="display: none;">
                        <div class="info-item">
                            <span class="info-label">Tipo de Servicio:</span>
                            <span id="autoTipo" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Acoplado:</span>
                            <span id="autoAcoplado" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Reglas:</span>
                            <span id="autoReglas" class="info-value">-</span>
                        </div>
                    </div>
                </div>

                <!-- MODO CONTRATADO -->
                <div id="modoContratado" style="display: none;">
                    <div class="form-group">
                        <label>ğŸ“ Destino Contratado:</label>
                        <input type="text" id="destinoContratado" class="form-control" 
                               placeholder="Ej: Hotel XYZ, Empresa ABC...">
                    </div>

                    <div class="form-group">
                        <label>ğŸ”¢ NÃºmero de Servicio:</label>
                        <input type="text" id="numeroContratado" class="form-control" 
                               placeholder="NÃºmero especÃ­fico...">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>ğŸ« Tipo de Servicio:</label>
                            <select id="tipoContratado" class="form-control">
                                <option value="DIRECTO">DIRECTO</option>
                                <option value="SEMI-DIRECTO">SEMI-DIRECTO</option>
                                <option value="TURNO">TURNO</option>
                                <option value="REGULAR">REGULAR</option>
                                <option value="ESPECIAL">ESPECIAL</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ğŸ”§ Acoplado:</label>
                            <select id="acopladoContratado" class="form-control">
                                <option value="false">NO</option>
                                <option value="true">SÃ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- CAMPOS COMUNES -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div class="form-group">
                        <label for="orderNumberTravels">NÃºmero de Orden *</label>
                        <input type="text" id="orderNumberTravels" required>
                    </div>
                    <div class="form-group">
                        <label for="originTravels">Origen *</label>
                        <input type="text" id="originTravels" required readonly style="background-color: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label for="destinationTravels">Destino *</label>
                        <input type="text" id="destinationTravels" required readonly style="background-color: #f8f9fa;">
                    </div>
                    
                    <div class="form-group">
                        <label for="kmTravels">KilÃ³metros *</label>
                        <input type="number" id="kmTravels" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="departureTimeTravels">Hora Salida *</label>
                        <input type="time" id="departureTimeTravels" required>
                    </div>
                    <div class="form-group">
                        <label for="arrivalTimeTravels">Hora Llegada *</label>
                        <input type="time" id="arrivalTimeTravels" required>
                    </div>
                </div>

                <button type="submit" class="btn-primary">â• Agregar Viaje</button>
            </form>
        </div>
    </div>

    <!-- PANTALLA GUARDIAS (MODAL) -->
    <div id="guardScreen" class="screen">
        <div class="screen-header">
           <button class="btn-back" onclick="showScreen('mainScreen')">â† Volver</button>
            <h1>ğŸ›¡ï¸ Nueva Guardia</h1>
        </div>
        <div class="screen-content">
            <form id="guardForm" onsubmit="addGuard(event)">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label for="guardOrderNumber">NÃºmero de Orden *</label>
                        <input type="text" id="guardOrderNumber" required>
                    </div>

                    <div class="form-group">
                        <label for="guardStartTime">Hora Inicio *</label>
                        <input type="time" id="guardStartTime" required>
                    </div>
                    <div class="form-group">
    <label for="guardDate">ğŸ“… Fecha de la guardia</label>
    <input type="date" id="guardDate" required>
</div>
                    <div class="form-group">
                        <label for="guardEndTime">Hora Fin *</label>
                        <input type="time" id="guardEndTime" required>
                    </div>
                     <!-- CAMPO DE TARIFA -->
                    <div class="form-group">
                        <label for="guardTarifa">Tipo de Guardia</label>
                        <select id="guardTarifa" onchange="actualizarDescripcionGuardia()">
                            <option value="30">ComÃºn - $30/hora</option>
                            <option value="40">Especial - $40/hora</option>
                        </select>
                    </div>
                </div>
                <!-- CAMPO DE TEXTO PARA DESCRIPCIÃ“N -->
                <div id="campoDescripcion" class="form-group" style="display: none;">
                    <label for="guardDescripcion">ğŸ“ DescripciÃ³n del Movimiento Especial *</label>
                    <textarea id="guardDescripcion" rows="3" placeholder="Ej: Traslado especial a hotel, Servicio fuera de horario, Movimiento extra..."></textarea>
                    <small style="color: #666;">Describe brevemente por quÃ© es una guardia especial</small>
                </div>
                <button type="submit" class="btn-primary">â• Agregar Guardia</button>
            </form>
        </div>
    </div>

    <!-- =========================================== -->
    <!-- ğŸ¯ PANTALLAS COMPLETAS - FUERA DEL CONTAINER -->
    <!-- =========================================== -->
    
    <!-- LISTA DE VIAJES -->
    <div id="travelListScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸ“‹ Lista de Viajes</h2>
        </div>
        
        <div class="lista-container" id="allTravelsList">
            <div class="no-data">No hay viajes registrados</div>
        </div>
    </div>

    <!-- LISTA DE GUARDIAS -->
    <div id="guardListScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸ‘¥ Lista de Guardias</h2>
        </div>
        
        <div class="lista-container" id="allGuardsList">
            <div class="no-data">No hay guardias registradas</div>
        </div>
    </div>
    
    <!-- PANTALLA DE REPORTES -->
    <div id="reportsScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸ“Š Reportes y BÃºsquedas</h2>
        </div>

        <!-- ğŸ›ï¸ PANEL DE FILTROS -->
        <div class="filters-panel">
            <div class="filter-group">
                <label>ğŸ“… Fecha Desde:</label>
                <input type="date" id="filterDateFrom" class="form-control">
            </div>
            <div class="filter-group">
                <label>ğŸ“… Fecha Hasta:</label>
                <input type="date" id="filterDateTo" class="form-control">
            </div>
            <div class="filter-group">
                <label>ğŸ”¢ NÂº de Orden:</label>
                <input type="text" id="filterOrderNumber" class="form-control" placeholder="Ej: ORD-001">
            </div>
            <div class="filter-group">
                <label>ğŸ‘¤ Conductor:</label>
                <input type="text" id="filterDriver" class="form-control" placeholder="Buscar conductor...">
            </div>
            <div class="filter-actions">
                <button class="btn-primary" onclick="generarReporte()">ğŸ” Generar Reporte</button>
                <button class="btn-secondary" onclick="limpiarFiltros()">ğŸ”„ Limpiar</button>
            </div>
        </div>

        <!-- ğŸ“Š RESUMEN RÃPIDO -->
        <div class="report-summary">
            <div class="summary-item">
                <span class="summary-label">Total Viajes:</span>
                <span class="summary-value" id="totalViajesReport">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Total KM:</span>
                <span class="summary-value" id="totalKmReport">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Total Horas:</span>
                <span class="summary-value" id="totalHorasReport">0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Total ViÃ¡ticos:</span>
                <span class="summary-value" id="totalViaticosReport">$0</span>
            </div>
        </div>

        <!-- ğŸ“‹ TABLA DE RESULTADOS (ESTILO PROFESIONAL) -->
        <div class="report-results">
            <div class="report-header">
                <h3>ğŸ“‹ Resultados del Reporte</h3>
                <div class="report-actions">
                    <span id="resultCount" class="result-count">0 registros encontrados</span>
                    <button class="btn-success" onclick="exportarReporte()">ğŸ“„ Exportar a PDF</button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>NÂº Orden</th>
                            <th>Conductor</th>
                            <th>Ruta</th>
                            <th>KM</th>
                            <th>Horas</th>
                            <th>ViÃ¡ticos</th>
                            <th>Tipo Servicio</th>
                        </tr>
                    </thead>
                    <tbody id="reportResultsBody">
                        <tr>
                            <td colspan="8" class="no-data">Usa los filtros para generar un reporte</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- PANTALLA BACKUP -->
    <div id="backupScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸ’¾ Backup y RestauraciÃ³n</h2>
        </div>
        <div class="form-container">
            <!-- EXPORTAR DATOS -->
            <div style="margin-bottom: 30px;">
                <h4 style="color: #27ae60; margin-bottom: 15px;">ğŸ“¤ Exportar Datos</h4>
                <div class="backup-actions">
                    <button class="backup-btn" onclick="exportData()">ğŸ’¾ Backup Completo</button>
                    <button class="backup-btn" onclick="exportTravels()">ğŸš— Solo Viajes</button>
                    <button class="backup-btn" onclick="exportGuards()">ğŸ›¡ï¸ Solo Guardias</button>
                </div>
            </div>
            
            <!-- IMPORTAR DATOS -->
            <div style="margin-bottom: 30px;">
                <h4 style="color: #3498db; margin-bottom: 15px;">ğŸ“¥ Importar Datos</h4>
                <div class="form-group">
                    <label for="backupFile">Seleccionar archivo JSON de backup</label>
                    <input type="file" id="backupFile" accept=".json">
                    <div id="importStatus" style="margin-top: 10px; font-weight: bold;"></div>
                </div>
                <button class="backup-btn" onclick="importData()" style="margin-top: 10px;">ğŸ”„ Restaurar Backup</button>
            </div>
            
            <!-- HERRAMIENTAS -->
            <div>
                <h4 style="color: #e74c3c; margin-bottom: 15px;">âš™ï¸ Herramientas</h4>
                <div class="backup-actions">
                    <button class="backup-btn warning" onclick="generateSampleData()">ğŸ¯ Generar Datos de Ejemplo</button>
                    <button class="backup-btn danger" onclick="clearAllData()">ğŸ—‘ï¸ Eliminar Todos los Datos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA MI SEMANA -->
    <div id="semanaScreen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mainScreen')">â† Volver</button>
            <h2>ğŸ“… Mi Semana</h2>
            <p>Resumen de todos tus viajes de esta semana</p>
        </div>

        <div class="container" style="background: white; padding: 20px;">
            <!-- ESTADÃSTICAS SEMANALES -->
            <div class="stats-grid" id="semanaStats" style="background: white;">
                <!-- Las estadÃ­sticas se cargarÃ¡n aquÃ­ con JavaScript -->
            </div>
            
            <!-- LISTA DE VIAJES DE LA SEMANA -->
            <div class="viajes-container" style="background: white;">
                <h3>ğŸ“‹ Viajes de la Semana</h3>
                <div id="semanaViajesList" class="lista-container">
                    <div class="no-data">Cargando viajes de la semana...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ¯ FUNCIÃ“N PARA GUARDAR USUARIO (LOGIN)
        function guardarUsuario() {
            const numero = document.getElementById('userNumber').value.trim();
            const nombre = document.getElementById('userName').value.trim();
            const rol = document.getElementById('userRole').value;
            
            if (!numero) {
                alert('Por favor ingresa tu nÃºmero de funcionario');
                return;
            }
            
            if (!nombre) {
                alert('Por favor ingresa tu nombre');
                return;
            }
            
            usuario = { 
                numero: numero, 
                nombre: nombre, 
                rol: rol 
            };
            
            localStorage.setItem('travelUser', JSON.stringify(usuario));
            
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
            
            console.log('âœ… Usuario guardado:', usuario);
        }

        // ğŸ¯ FUNCIÃ“N PARA CARGAR USUARIO AL INICIAR
        function cargarUsuario() {
            const usuarioGuardado = localStorage.getItem('travelUser');
            
            if (usuarioGuardado) {
                usuario = JSON.parse(usuarioGuardado);
                console.log('âœ… Usuario cargado:', usuario);
                
                setTimeout(() => {
                    document.getElementById('splashScreen').classList.remove('active');
                    document.getElementById('mainScreen').classList.add('active');
                }, 1000);
                
            } else {
                setTimeout(() => {
                    document.getElementById('splashScreen').classList.remove('active');
                    document.getElementById('loginScreen').classList.add('active');
                }, 2000);
            }
        }

        // ğŸ¯ INICIAR LA APLICACIÃ“N
        <script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Iniciando aplicaciÃ³n...');
    cargarUsuario();
});
</script>

<!-- âœ… FUNCIÃ“N showScreen ÃšNICA Y SIMPLE -->
<script>
function showScreen(screenId) {
    console.log('ğŸ¯ Mostrando pantalla:', screenId);

    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });

    const target = document.getElementById(screenId);
    if (target) {
        target.classList.add('active');
    }
}
</script>

<!-- ğŸš— TU SCRIPT ACTUAL -->
<script src="app.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const travelDateInput = document.getElementById('travelDate');
    if (travelDateInput) {
        travelDateInput.value = new Date().toISOString().split('T')[0];
    }
});
</script>
</body>
</html>























































































































