
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#D4A017">
<link rel="apple-touch-icon" href="icons/icon-192.png">
    <title>COT - Control de Kil√≥metros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --crema: #FFF8E1;
            --ocre: #D4A017;
            --marron: #8B4513;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, var(--crema) 0%, var(--ocre) 100%);
            min-height: 100vh; padding: 20px; color: #333;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .screen { display: none; background: white; border-radius: 15px; padding: 25px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .screen.active { display: block; }
        
        /* PANTALLA PRINCIPAL */
        .logo-container { text-align: center; margin-bottom: 30px; }
        .logo-title { font-size: 3em; font-weight: bold; color: var(--ocre); margin-bottom: 10px; }
        .logo-subtitle { font-size: 1.2em; color: var(--marron); font-weight: 600; }
        
        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 25px 0; }
        .stat-card { background: var(--crema); padding: 20px; border-radius: 10px; text-align: center; border-top: 4px solid var(--ocre); }
        .stat-value { font-size: 1.8em; font-weight: 800; color: var(--marron); }
        .stat-label { font-size: 0.8em; color: #666; font-weight: 600; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-card { background: white; padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; border: 2px solid var(--crema); transition: all 0.3s; }
        .menu-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--ocre); }
        .menu-icon { font-size: 2em; margin-bottom: 10px; color: var(--ocre); }
        .menu-title { font-weight: 700; color: var(--marron); margin-bottom: 5px; }
        .menu-desc { font-size: 0.8em; color: #666; }
        
        /* HEADER */
        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .back-btn { background: var(--ocre); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 16px; }
        .header-title h1 { color: var(--marron); margin-bottom: 5px; }
        .header-title p { color: #666; font-size: 0.9em; }
        
        /* FORMULARIOS */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--marron); }
        input, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .time-group { display: flex; gap: 10px; }
        .time-group input { flex: 1; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-date { flex: 1; padding: 10px; background: var(--ocre); color: white; border: none; border-radius: 8px; cursor: pointer; }
        button { background: var(--ocre); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; }
        .btn-danger { background: var(--marron); }
        
        /* LISTAS */
        .list-item { background: #f9f9f9; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid var(--ocre); }
        .list-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .list-item-title { font-weight: bold; color: var(--marron); }
        .btn-sm { padding: 8px 12px; font-size: 12px; width: auto; }
        
        @media (max-width: 768px) {
            .menu-grid, .stats-bar { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- PANTALLA PRINCIPAL -->
        <div id="mainScreen" class="screen active">
            <div class="logo-container">
                <div class="logo-title">COT</div>
                <div class="logo-subtitle">CONTROL DE KIL√ìMETROS</div>
               
            </div>
            <div class="menu-grid">
                <div class="menu-card" onclick="showScreen('travelScreen')">
                    <div class="menu-icon">üöå</div>
                    <div class="menu-title">Registrar Viaje</div>
                    <div class="menu-desc">Agregar nuevo recorrido</div>
                </div>
                <div class="menu-card" onclick="showScreen('guardScreen')">
                    <div class="menu-icon">‚è∞</div>
                    <div class="menu-title">Registrar Guardia</div>
                    <div class="menu-desc">Control de guardias</div>
                </div>
                <div class="menu-card" onclick="showScreen('summaryScreen')">
                    <div class="menu-icon">üìä</div>
                    <div class="menu-title">Resumen General</div>
                    <div class="menu-desc">Estad√≠sticas del mes</div>
                </div>
                <div class="menu-card" onclick="showScreen('reportsScreen')">
                    <div class="menu-icon">üìà</div>
                    <div class="menu-title">Reportes</div>
                    <div class="menu-desc">An√°lisis detallados</div>
                </div>
                <div class="menu-card" onclick="showScreen('travelsListScreen')">
                    <div class="menu-icon">üìã</div>
                    <div class="menu-title">Lista de Viajes</div>
                    <div class="menu-desc">Ver viajes registrados</div>
                </div>
                <div class="menu-card" onclick="showScreen('guardsListScreen')">
                    <div class="menu-icon">üïí</div>
                    <div class="menu-title">Lista de Guardias</div>
                    <div class="menu-desc">Ver guardias registradas</div>
                </div>
            </div>
        </div>

       <!-- PANTALLA REGISTRAR VIAJE -->
<div id="travelScreen" class="screen">
    <div class="header">
        <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
        <div class="header-title">
            <h1>Registrar Viaje</h1>
            <p>Complete los datos del servicio</p>
        </div>
    </div>

    <div class="form-group">
        <label>Fecha del Viaje:</label>
        <div class="btn-group">
            <button type="button" class="btn-date" onclick="setFecha('fechaViaje', 0)">Hoy</button>
            <button type="button" class="btn-date" onclick="setFecha('fechaViaje', -1)">Ayer</button>
            <button type="button" class="btn-date" onclick="setFecha('fechaViaje', -2)">Hace 2 d√≠as</button>
        </div>
        <input type="date" id="fechaViaje">
    </div>

    <!-- SELECTOR DE TURNO -->
   <div class="form-group">
    <label>Seleccionar Ruta:</label>
    <select id="turnoSeleccionado" onchange="cargarDatosTurno()">
        <option value="">-- Selecciona ruta --</option>
        <option value="1">1 - Punta del Este</option>
        <option value="2">2 - Punta del Este (Directo)</option>
        <option value="11">11 - Colonia</option>
        <option value="12">12 - Colonia (Directo)</option>
        <option value="31">31 - Punta del Este (Ruta 9)</option>
        <option value="41">41 - San Jos√©</option>
        <option value="51">51 - Canelones</option>
        <option value="61">61 - Melo</option>
        <option value="71">71 - Rivera</option>
        <option value="manual">+ Agregar destino manual</option>
    </select>
</div>

    <!-- N√öMERO DE ORDEN -->
    <div class="form-group">
        <label>N√∫mero de Orden:</label>
        <input type="number" id="orderNumber" placeholder="Ej: 123">
    </div>

    <!-- CAMPOS AUTOCOMPLETADOS -->
    <div class="form-group">
        <label>Origen:</label>
        <input type="text" id="origin" placeholder="Se autocompletar√°" readonly>
    </div>
    <div class="form-group">
        <label>Destino:</label>
        <input type="text" id="destination" placeholder="Se autocompletar√°" readonly>
    </div>
    <div class="form-group">
        <label>Kil√≥metros:</label>
        <input type="number" id="km" placeholder="Se autocompletar√°" step="0.1" readonly>
    </div>

    <!-- HORARIOS -->
    <div class="form-group">
        <label>Horarios:</label>
        <div class="time-group">
            <input type="time" id="departureTime">
            <input type="time" id="arrivalTime">
        </div>
    </div>

    <!-- TIPO DE VIAJE -->
    <div class="form-group">
        <label>Tipo:</label>
        <select id="travelType">
            <option value="working">Trabajando</option>
            <option value="passenger">De Pasajero</option>
        </select>
    </div>

    <button onclick="addTravel()">Agregar Viaje</button>
</div>

        <!-- PANTALLA REGISTRAR GUARDIA -->
        <div id="guardScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
                <div class="header-title">
                    <h1>Registrar Guardia</h1>
                    <p>Complete los datos de la guardia</p>
                </div>
            </div>

            <div class="form-group">
                <label>Fecha de la Guardia:</label>
                <div class="btn-group">
                    <button type="button" class="btn-date" onclick="setFecha('fechaGuardia', 0)">Hoy</button>
                    <button type="button" class="btn-date" onclick="setFecha('fechaGuardia', -1)">Ayer</button>
                    <button type="button" class="btn-date" onclick="setFecha('fechaGuardia', -2)">Hace 2 d√≠as</button>
                </div>
                <input type="date" id="fechaGuardia">
            </div>

            <div class="form-group">
                <label>Tipo de Guardia:</label>
                <select id="guardType">
                    <option value="common">Guardia Com√∫n (30 km/h)</option>
                    <option value="special">Guardia Especial (40 km/h)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Horario de Guardia:</label>
                <div class="time-group">
                    <input type="time" id="guardStart">
                    <input type="time" id="guardEnd">
                </div>
            </div>
            <button onclick="addGuard()">Agregar Guardia</button>
        </div>

        <!-- PANTALLA RESUMEN -->
        <div id="summaryScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
                <div class="header-title">
                    <h1>Resumen General</h1>
                    <p>Estad√≠sticas del mes</p>
                </div>
            </div>
            <div id="summaryContent">
                <p>Km Trabajando: <span id="totalWorking">0</span> km</p>
                <p>Km de Pasajero: <span id="totalPassenger">0</span> km</p>
                <p>Km por Guardias: <span id="totalGuards">0</span> km</p>
                <p><strong>TOTAL KM: <span id="totalAll">0</span> km</strong></p>
                <p><strong>TOTAL A COBRAR: $<span id="totalMoney">0</span></strong></p>
            </div>
            <button onclick="exportData()">Exportar Resumen</button>
            <button onclick="clearMonth()" class="btn-danger">Reiniciar Mes</button>
        </div>

        <!-- PANTALLA LISTA VIAJES -->
        <div id="travelsListScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
                <div class="header-title">
                    <h1>Lista de Viajes</h1>
                    <p>Viajes registrados</p>
                </div>
            </div>
            <div id="travelsList"></div>
        </div>

        <!-- PANTALLA LISTA GUARDIAS -->
        <div id="guardsListScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
                <div class="header-title">
                    <h1>Lista de Guardias</h1>
                    <p>Guardias registradas</p>
                </div>
            </div>
            <div id="guardsList"></div>
        </div>

        <!-- PANTALLA REPORTES -->
        <div id="reportsScreen" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
                <div class="header-title">
                    <h1>Reportes</h1>
                    <p>An√°lisis detallados</p>
                </div>
            </div>
            <button onclick="mostrarReporteHoy()" style="margin-bottom: 10px;">Ver Reporte de Hoy</button>
            <button onclick="mostrarReporteMes()">Ver Reporte del Mes</button>
            <div id="reportesContent" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        const PRICE_PER_KM = 7.60;
        // BASE DE DATOS DE RUTAS COT - SISTEMA DE TURNOS
const rutasCOT = {
    // MONTEVIDEO - PUNTA DEL ESTE
    1: { origen: "Montevideo", destino: "Punta del Este", km: 134, tipo: "normal", descripcion: "Turno Normal" },
    2: { origen: "Montevideo", destino: "Punta del Este", km: 134, tipo: "directo", descripcion: "Directo" },
    
    // MONTEVIDEO - COLONIA
    11: { origen: "Montevideo", destino: "Colonia", km: 178, tipo: "normal", descripcion: "Turno Normal" },
    12: { origen: "Montevideo", destino: "Colonia", km: 178, tipo: "directo", descripcion: "Directo" },
    
    // MONTEVIDEO - PUNTA DEL ESTE (RUTA 9)
    31: { origen: "Montevideo", destino: "Punta del Este", km: 145, tipo: "ruta9", descripcion: "Por Ruta 9" },
    
    // MONTEVIDEO - SAN JOS√â
    41: { origen: "Montevideo", destino: "San Jos√©", km: 96, tipo: "normal", descripcion: "Turno Normal" },
    
    // MONTEVIDEO - CANELONES
    51: { origen: "Montevideo", destino: "Canelones", km: 54, tipo: "normal", descripcion: "Turno Normal" },
    
    // AGREGAR M√ÅS RUTAS SEG√öN NECESITES
    61: { origen: "Montevideo", destino: "Melo", km: 389, tipo: "normal", descripcion: "Turno Normal" },
    71: { origen: "Montevideo", destino: "Rivera", km: 505, tipo: "normal", descripcion: "Turno Normal" }
};
        let travels = JSON.parse(localStorage.getItem('bus_travels')) || [];
        let guards = JSON.parse(localStorage.getItem('bus_guards')) || [];
        
        // CALCULAR HORAS TOTALES POR N√öMERO DE ORDEN
function calcularHorasPorOrden(numeroOrden) {
    // Buscar todos los viajes con este n√∫mero de orden
    const viajesDelOrden = travels.filter(t => t.orderNumber === numeroOrden);
    
    if (viajesDelOrden.length === 0) return 0;
    
    // Ordenar por timestamp (m√°s antiguo primero)
    viajesDelOrden.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    
    // Tomar hora del primer viaje (inicio) y √∫ltimo viaje (fin)
    const primerViaje = viajesDelOrden[0];
    const ultimoViaje = viajesDelOrden[viajesDelOrden.length - 1];
    
    // Calcular diferencia en horas
    const inicio = new Date(primerViaje.timestamp);
    const fin = new Date(ultimoViaje.timestamp);
    const horasTotales = (fin - inicio) / (1000 * 60 * 60);
    
    return horasTotales;
}
    // ACTUALIZAR VI√ÅTICOS EN VIAJES EXISTENTES
function actualizarViaticosExistentes() {
    const ordenesUnicos = [...new Set(travels.map(t => t.orderNumber))];
    
    ordenesUnicos.forEach(orden => {
        const horasTotales = calcularHorasPorOrden(orden);
        const tieneViatico = horasTotales >= 9 ? 1 : 0;
        
        // Actualizar todos los viajes de este orden
        travels.forEach(travel => {
            if (travel.orderNumber === orden) {
                travel.viaticos = tieneViatico;
            }
        });
    });
    
    localStorage.setItem('bus_travels', JSON.stringify(travels));
    renderTravels();
    updateSummary();
}    
// FUNCI√ìN MEJORADA PARA CARGAR DATOS DEL TURNO
function cargarDatosTurno() {
    const turnoId = document.getElementById('turnoSeleccionado').value;
    
    if (turnoId === 'manual') {
        // MODO MANUAL - campos editables
        document.getElementById('origin').readOnly = false;
        document.getElementById('destination').readOnly = false;
        document.getElementById('km').readOnly = false;
        // Limpiar campos
        document.getElementById('origin').value = '';
        document.getElementById('destination').value = '';
        document.getElementById('km').value = '';
        document.getElementById('origin').placeholder = 'Ej: Montevideo';
        document.getElementById('destination').placeholder = 'Ej: Punta del Este';
        document.getElementById('km').placeholder = 'Ej: 140';
    } else if (turnoId && rutasCOT[turnoId]) {
        // MODO AUTOM√ÅTICO - autocompletar
        const ruta = rutasCOT[turnoId];
        document.getElementById('origin').value = ruta.origen;
        document.getElementById('destination').value = ruta.destino;
        document.getElementById('km').value = ruta.km;
        // Campos en solo lectura
        document.getElementById('origin').readOnly = true;
        document.getElementById('destination').readOnly = true;
        document.getElementById('km').readOnly = true;
        document.getElementById('origin').placeholder = 'Se autocomplet√≥';
        document.getElementById('destination').placeholder = 'Se autocomplet√≥';
        document.getElementById('km').placeholder = 'Se autocomplet√≥';
    } else {
        // Limpiar y hacer editables
        document.getElementById('origin').value = '';
        document.getElementById('destination').value = '';
        document.getElementById('km').value = '';
        document.getElementById('origin').readOnly = false;
        document.getElementById('destination').readOnly = false;
        document.getElementById('km').readOnly = false;
    }
}
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'mainScreen') updateMainStats();
            if (screenId === 'summaryScreen') updateSummary();
            if (screenId === 'travelsListScreen') renderTravels();
            if (screenId === 'guardsListScreen') renderGuards();
        }

        function setFecha(elementId, dias) {
            const fecha = new Date();
            fecha.setDate(fecha.getDate() + dias);
            document.getElementById(elementId).value = fecha.toISOString().split('T')[0];
        }

        // CONFIGURACI√ìN INICIAL
        document.addEventListener('DOMContentLoaded', function() {
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaViaje').value = hoy;
            document.getElementById('fechaGuardia').value = hoy;
            updateMainStats();
            updateSummary();
        });

        // AGREGAR VIAJE
       function addTravel() {
    const orderNumber = document.getElementById('orderNumber').value;
    const origin = document.getElementById('origin').value;
    const destination = document.getElementById('destination').value;
    const km = parseFloat(document.getElementById('km').value);
    const travelType = document.getElementById('travelType').value;
    const departureTime = document.getElementById('departureTime').value;
    const arrivalTime = document.getElementById('arrivalTime').value;
    const fechaInput = document.getElementById('fechaViaje').value;

    if (!orderNumber || !origin || !destination || !km || !departureTime || !arrivalTime) {
        alert('Complete todos los campos');
        return;
    }

    // CALCULAR VI√ÅTICOS POR N√öMERO DE ORDEN (‚â•9 horas totales)
const horasTotalesOrden = calcularHorasPorOrden(orderNumber);
const viaticos = horasTotalesOrden >= 9 ? 1 : 0;

// CALCULAR HORAS DE ESTE VIAJE INDIVIDUAL (para mostrar en lista)
const start = new Date(`2000-01-01T${departureTime}`);
const end = new Date(`2000-01-01T${arrivalTime}`);
let hoursWorked = (end - start) / (1000 * 60 * 60);
if (hoursWorked < 0) hoursWorked += 24;

// CALCULAR ACOPLADOS AUTOM√ÅTICAMENTE (directos = +30km)
const turnoSeleccionado = document.getElementById('turnoSeleccionado');
const descripcionTurno = turnoSeleccionado.options[turnoSeleccionado.selectedIndex].text;
const esDirecto = descripcionTurno.includes('Directo');
const acoplados = esDirecto ? 1 : 0;
const kmTotal = esDirecto ? km + 30 : km;

// CALCULAR ACOPLADOS AUTOM√ÅTICAMENTE (directos = +30km)
const turnoSeleccionado = document.getElementById('turnoSeleccionado');
const descripcionTurno = turnoSeleccionado.options[turnoSeleccionado.selectedIndex].text;
const esDirecto = descripcionTurno.includes('Directo');
const acoplados = esDirecto ? 1 : 0;
const kmTotal = esDirecto ? km + 30 : km;

let fechaViaje;
if (fechaInput) {
    const [a√±o, mes, dia] = fechaInput.split('-');
    fechaViaje = `${dia}/${mes}/${a√±o}`;
} else {
    fechaViaje = new Date().toLocaleDateString('es-ES');
}

const travel = {
    id: Date.now(),
    orderNumber, origin, destination, 
    km: kmTotal, // ‚Üê KM TOTAL (ruta + 30km si es directo)
    kmRuta: km,  // ‚Üê KM SOLO DE LA RUTA
    acoplados: acoplados, // ‚Üê 1 si es directo, 0 si no
    type: travelType,
    departureTime, arrivalTime, date: fechaViaje,
    hours: hoursWorked.toFixed(2),
    viaticos: viaticos,
    timestamp: new Date().toISOString()
};

    travels.push(travel);
    localStorage.setItem('bus_travels', JSON.stringify(travels));
    
    // Limpiar campos
    document.getElementById('orderNumber').value = '';
    document.getElementById('turnoSeleccionado').value = '';
    document.getElementById('origin').value = '';
    document.getElementById('destination').value = '';
    document.getElementById('km').value = '';
    document.getElementById('departureTime').value = '';
    document.getElementById('arrivalTime').value = '';
    
    updateMainStats();
    updateSummary();
    alert('‚úÖ Viaje agregado! ' + (viaticos ? '(Con vi√°tico)' : ''));
    showScreen('mainScreen');
}

        // AGREGAR GUARDIA
        function addGuard() {
    const guardType = document.getElementById('guardType').value;
    const guardStart = document.getElementById('guardStart').value;
    const guardEnd = document.getElementById('guardEnd').value;
    const fechaInput = document.getElementById('fechaGuardia').value;

    if (!guardStart || !guardEnd) {
        alert('Ingrese horario de inicio y fin');
        return;
    }

    // CALCULAR VI√ÅTICOS AUTOM√ÅTICAMENTE (‚â•9 horas)
    const start = new Date(`2000-01-01T${guardStart}`);
    const end = new Date(`2000-01-01T${guardEnd}`);
    let hoursWorked = (end - start) / (1000 * 60 * 60);
    if (hoursWorked < 0) hoursWorked += 24;
    
    const viaticos = hoursWorked >= 9 ? 1 : 0;

    let fechaGuardia;
    if (fechaInput) {
        const [a√±o, mes, dia] = fechaInput.split('-');
        fechaGuardia = `${dia}/${mes}/${a√±o}`;
    } else {
        fechaGuardia = new Date().toLocaleDateString('es-ES');
    }

    if (hoursWorked <= 0) {
        alert('La hora de fin debe ser posterior');
        return;
    }

    const kmPerHour = guardType === 'common' ? 30 : 40;
    const totalKm = hoursWorked * kmPerHour;

    const guard = {
        id: Date.now(),
        type: guardType, startTime: guardStart, endTime: guardEnd,
        hours: hoursWorked.toFixed(2), km: totalKm.toFixed(1), 
        viaticos: viaticos, // ‚Üê NUEVO CAMPO
        date: fechaGuardia
    };

    guards.push(guard);
    localStorage.setItem('bus_guards', JSON.stringify(guards));
    
    document.getElementById('guardStart').value = '';
    document.getElementById('guardEnd').value = '';
    
    updateMainStats();
    updateSummary();
    alert('‚úÖ Guardia agregada! ' + (viaticos ? '(Con vi√°tico)' : ''));
    showScreen('mainScreen');
}
        // ACTUALIZAR ESTAD√çSTICAS
        function updateMainStats() {
            const totalWorking = travels.filter(t => t.type === 'working').reduce((sum, t) => sum + t.km, 0);
            const totalPassenger = travels.filter(t => t.type === 'passenger').reduce((sum, t) => sum + t.km, 0);
            const totalGuards = guards.reduce((sum, g) => sum + parseFloat(g.km), 0);
            const totalAll = totalWorking + totalPassenger + totalGuards;
            const totalMoney = totalAll * PRICE_PER_KM;

            document.getElementById('mainTotalKm').textContent = totalAll.toFixed(0);
            document.getElementById('mainTotalMoney').textContent = `$${totalMoney.toFixed(0)}`;
            document.getElementById('mainTotalTravels').textContent = travels.length;
        }

        function updateSummary() {
            const totalWorking = travels.filter(t => t.type === 'working').reduce((sum, t) => sum + t.km, 0);
            const totalPassenger = travels.filter(t => t.type === 'passenger').reduce((sum, t) => sum + t.km, 0);
            const totalGuards = guards.reduce((sum, g) => sum + parseFloat(g.km), 0);
            const totalAll = totalWorking + totalPassenger + totalGuards;
            const totalMoney = totalAll * PRICE_PER_KM;

            document.getElementById('totalWorking').textContent = totalWorking.toFixed(1);
            document.getElementById('totalPassenger').textContent = totalPassenger.toFixed(1);
            document.getElementById('totalGuards').textContent = totalGuards.toFixed(1);
            document.getElementById('totalAll').textContent = totalAll.toFixed(1);
            document.getElementById('totalMoney').textContent = totalMoney.toFixed(2);
        }

        // MOSTRAR LISTAS MEJORADA
function renderTravels() {
    const travelsList = document.getElementById('travelsList');
    travelsList.innerHTML = '';

    if (travels.length === 0) {
        travelsList.innerHTML = '<p>No hay viajes registrados</p>';
        return;
    }

    // CREAR TABLA
    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';
    table.style.marginTop = '10px';
    
    // ENCABEZADO DE TABLA
    const header = document.createElement('tr');
    header.innerHTML = `
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: left;">ORDEN</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: left;">ORIGEN</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: left;">DESTINO</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: center;">KM</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: center;">HORAS</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: center;">VIAT</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: center;">ACOP</th>
        <th style="padding: 10px; border-bottom: 2px solid var(--ocre); text-align: center;">ACCION</th>
    `;
    table.appendChild(header);

    // FILAS DE DATOS
    travels.forEach(travel => {
        const row = document.createElement('tr');
        row.style.borderBottom = '1px solid #eee';
        
        row.innerHTML = `
            <td style="padding: 8px; font-weight: bold;">${travel.orderNumber}</td>
            <td style="padding: 8px;">${travel.origin}</td>
            <td style="padding: 8px;">${travel.destination}</td>
            <td style="padding: 8px; text-align: center;">${travel.km}</td>
            <td style="padding: 8px; text-align: center;">${travel.hours || '0'}</td>
            <td style="padding: 8px; text-align: center; color: ${travel.viaticos ? 'green' : 'gray'}">${travel.viaticos ? 'S√≠' : 'No'}</td>
            <td style="padding: 8px; text-align: center; color: ${travel.acoplados ? 'blue' : 'gray'}">${travel.acoplados ? '30' : '0'}</td>
            <td style="padding: 8px; text-align: center;">
                <button onclick="deleteTravel(${travel.id})" class="btn-danger btn-sm">Eliminar</button>
            </td>
        `;
        table.appendChild(row);
    });

    travelsList.appendChild(table);
}
        function renderGuards() {
            const guardsList = document.getElementById('guardsList');
            guardsList.innerHTML = '';

            if (guards.length === 0) {
                guardsList.innerHTML = '<p>No hay guardias registradas</p>';
                return;
            }

            guards.forEach(guard => {
                const guardItem = document.createElement('div');
                guardItem.className = 'list-item';
                guardItem.innerHTML = `
                    <div class="list-item-header">
                        <div class="list-item-title">Guardia ${guard.type === 'common' ? 'Com√∫n' : 'Especial'}</div>
                        <button onclick="deleteGuard(${guard.id})" class="btn-danger btn-sm">Eliminar</button>
                    </div>
                    <p>${guard.startTime} - ${guard.endTime} (${guard.hours} horas)</p>
                    <p>${guard.km} km - ${guard.date}</p>
                `;
                guardsList.appendChild(guardItem);
            });
        }

        // ELIMINAR
        function deleteTravel(id) {
            if (confirm('¬øEliminar este viaje?')) {
                travels = travels.filter(travel => travel.id !== id);
                localStorage.setItem('bus_travels', JSON.stringify(travels));
                renderTravels();
                updateMainStats();
                updateSummary();
            }
        }

        function deleteGuard(id) {
            if (confirm('¬øEliminar esta guardia?')) {
                guards = guards.filter(guard => guard.id !== id);
                localStorage.setItem('bus_guards', JSON.stringify(guards));
                renderGuards();
                updateMainStats();
                updateSummary();
            }
        }

        // REPORTES
        function mostrarReporteHoy() {
            const hoy = new Date().toLocaleDateString('es-ES');
            const viajesHoy = travels.filter(t => t.date === hoy);
            const guardiasHoy = guards.filter(g => g.date === hoy);
            
            let contenido = `
                <h3>üìÖ Reporte del D√≠a: ${hoy}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>üöå Viajes Hoy</h4>
                        <p><strong>Cantidad:</strong> ${viajesHoy.length}</p>
                        <p><strong>Total KM:</strong> ${viajesHoy.reduce((sum, v) => sum + v.km, 0).toFixed(1)} km</p>
                    </div>
                    <div style="background: #f0fff0; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>‚è∞ Guardias Hoy</h4>
                        <p><strong>Cantidad:</strong> ${guardiasHoy.length}</p>
                        <p><strong>Total KM:</strong> ${guardiasHoy.reduce((sum, g) => sum + parseFloat(g.km), 0).toFixed(1)} km</p>
                    </div>
                </div>
            `;
            
            document.getElementById('reportesContent').innerHTML = contenido;
        }

        function mostrarReporteMes() {
            const hoy = new Date();
            const primerDiaMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
            const nombreMes = hoy.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
            
            const viajesMes = travels.filter(viaje => {
                const [dia, mes, a√±o] = viaje.date.split('/');
                const fechaViaje = new Date(a√±o, mes - 1, dia);
                return fechaViaje >= primerDiaMes;
            });
            
            const guardiasMes = guards.filter(guardia => {
                const [dia, mes, a√±o] = guardia.date.split('/');
                const fechaGuardia = new Date(a√±o, mes - 1, dia);
                return fechaGuardia >= primerDiaMes;
            });
            
            let contenido = `
                <h3>üìà Reporte del Mes: ${nombreMes}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>üöå Viajes del Mes</h4>
                        <p><strong>Cantidad:</strong> ${viajesMes.length}</p>
                        <p><strong>Total KM:</strong> ${viajesMes.reduce((sum, v) => sum + v.km, 0).toFixed(1)} km</p>
                    </div>
                    <div style="background: #f0fff0; padding: 15px; border-radius: 8px; text-align: center;">
                        <h4>‚è∞ Guardias del Mes</h4>
                        <p><strong>Cantidad:</strong> ${guardiasMes.length}</p>
                        <p><strong>Total KM:</strong> ${guardiasMes.reduce((sum, g) => sum + parseFloat(g.km), 0).toFixed(1)} km</p>
                    </div>
                </div>
            `;
            
            document.getElementById('reportesContent').innerHTML = contenido;
        }

        // OTRAS FUNCIONES
        function exportData() {
            alert('üìÑ Funcionalidad de exportaci√≥n - Pr√≥ximamente');
        }

               
        function clearMonth() {
            if (confirm('¬øReiniciar todos los datos?')) {
                travels = [];
                guards = [];
                localStorage.removeItem('bus_travels');
                localStorage.removeItem('bus_guards');
                updateMainStats();
                updateSummary();
                renderTravels();
                renderGuards();
            }
        }
    // SERVICE WORKER REGISTRATION - AL FINAL
 if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW registrado'))
                .catch(err => console.log('SW error:', err));
        });
    }
    </script>
</body>
</html>


























































