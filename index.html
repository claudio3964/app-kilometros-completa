<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COT - Control de Kil√≥metros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [Todo el CSS anterior se mantiene igual] */
        :root {
            --cot-azul: #0055A4;
            --cot-azul-oscuro: #003B76;
            --cot-rojo: #E4002B;
            --cot-blanco: #FFFFFF;
            --cot-gris-claro: #F5F5F5;
            --cot-gris: #666666;
            --cot-texto: #333333;
            --gradient-cot: linear-gradient(135deg, var(--cot-azul) 0%, var(--cot-azul-oscuro) 100%);
            --gradient-cot-horizontal: linear-gradient(90deg, var(--cot-azul) 0%, var(--cot-azul-oscuro) 100%);
            --gradient-cot-red: linear-gradient(135deg, var(--cot-azul) 0%, var(--cot-rojo) 100%);
            --shadow-cot: 0 4px 12px rgba(0, 85, 164, 0.15);
            --shadow-cot-hover: 0 8px 25px rgba(0, 85, 164, 0.25);
            --border-radius: 10px;
            --border-radius-lg: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-cot);
            min-height: 100vh;
            color: var(--cot-texto);
            line-height: 1.6;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--cot-gris-claro);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
            transform: translateX(0);
        }

        .screen.hidden {
            transform: translateX(100%);
        }

        /* [Todo el resto del CSS se mantiene igual] */
        /* ... */

    </style>
</head>
<body>
    <div class="app-container">
        <!-- PANTALLA PRINCIPAL -->
        <div id="mainScreen" class="screen active">
            <!-- [Contenido de la pantalla principal] -->
        </div>

        <!-- PANTALLA REGISTRAR VIAJE -->
        <div id="travelScreen" class="screen hidden">
            <!-- [Contenido ya existente] -->
        </div>

        <!-- PANTALLA REGISTRAR GUARDIA (FALTABA) -->
        <div id="guardScreen" class="screen hidden">
            <div class="app-header">
                <div class="header-content">
                    <button class="back-btn" onclick="showScreen('mainScreen')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">
                        <h1><i class="fas fa-user-clock"></i> Registrar Guardia</h1>
                        <p>Complete los datos de la guardia</p>
                    </div>
                </div>
            </div>

            <div class="form-container fade-in-up">
                <div class="form-group">
                    <label class="form-label">Fecha de la Guardia</label>
                    <div class="btn-group">
                        <button type="button" class="btn-date" data-dias="0" data-target="fechaGuardia">
                            <i class="fas fa-calendar-day"></i> Hoy
                        </button>
                        <button type="button" class="btn-date" data-dias="-1" data-target="fechaGuardia">
                            <i class="fas fa-calendar-minus"></i> Ayer
                        </button>
                        <button type="button" class="btn-date" data-dias="-2" data-target="fechaGuardia">
                            <i class="fas fa-calendar-week"></i> Hace 2 d√≠as
                        </button>
                    </div>
                    <input type="date" id="fechaGuardia" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label">Tipo de Guardia</label>
                    <select id="guardType" class="form-select">
                        <option value="common">üïí Guardia Com√∫n (30 km/h)</option>
                        <option value="special">‚≠ê Guardia Especial (40 km/h)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Horario de Guardia</label>
                    <div class="time-group">
                        <input type="time" id="guardStart" class="form-input" placeholder="Hora inicio">
                        <input type="time" id="guardEnd" class="form-input" placeholder="Hora fin">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="addGuard()" style="width: 100%;">
                    <i class="fas fa-plus-circle"></i> Agregar Guardia
                </button>
            </div>
        </div>

        <!-- PANTALLA RESUMEN GENERAL (FALTABA) -->
        <div id="summaryScreen" class="screen hidden">
            <div class="app-header">
                <div class="header-content">
                    <button class="back-btn" onclick="showScreen('mainScreen')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">
                        <h1><i class="fas fa-chart-pie"></i> Resumen General</h1>
                        <p>Estad√≠sticas completas del mes</p>
                    </div>
                </div>
            </div>

            <div class="form-container fade-in-up">
                <div class="summary-grid">
                    <div class="summary-card primary">
                        <div class="summary-value" id="totalWorking">0</div>
                        <div class="summary-label">KM Trabajando</div>
                    </div>
                    <div class="summary-card success">
                        <div class="summary-value" id="totalPassenger">0</div>
                        <div class="summary-label">KM Pasajero</div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-value" id="totalGuards">0</div>
                        <div class="summary-label">KM Guardias</div>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 2.5em; font-weight: 800; color: var(--cot-azul);" id="totalAll">0</div>
                    <div style="color: var(--cot-gris); font-weight: 600;">TOTAL KIL√ìMETROS</div>
                </div>

                <div style="text-align: center; margin: 30px 0; padding: 20px; background: var(--gradient-cot); border-radius: var(--border-radius); color: white;">
                    <div style="font-size: 2em; font-weight: 800;" id="totalMoney">$0</div>
                    <div style="font-weight: 600;">TOTAL A COBRAR</div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="exportData()" style="flex: 1;">
                        <i class="fas fa-file-export"></i> Exportar
                    </button>
                    <button class="btn btn-danger" onclick="clearMonth()" style="flex: 1;">
                        <i class="fas fa-trash"></i> Reiniciar Mes
                    </button>
                </div>
            </div>
        </div>

        <!-- PANTALLA REPORTES (FALTABA) -->
        <div id="reportsScreen" class="screen hidden">
            <div class="app-header">
                <div class="header-content">
                    <button class="back-btn" onclick="showScreen('mainScreen')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">
                        <h1><i class="fas fa-file-alt"></i> Reportes</h1>
                        <p>An√°lisis detallados de actividad</p>
                    </div>
                </div>
            </div>

            <div class="form-container fade-in-up">
                <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                    <button class="btn btn-primary" onclick="mostrarReporteHoy()" style="flex: 1;">
                        <i class="fas fa-calendar-day"></i> Reporte de Hoy
                    </button>
                    <button class="btn btn-primary" onclick="mostrarReporteMes()" style="flex: 1;">
                        <i class="fas fa-calendar-month"></i> Reporte del Mes
                    </button>
                </div>

                <div id="reportesContent">
                    <div style="text-align: center; padding: 40px; color: var(--cot-gris);">
                        <i class="fas fa-chart-bar" style="font-size: 3em; margin-bottom: 15px;"></i>
                        <p>Selecciona un tipo de reporte para ver los datos</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANTALLA LISTA DE VIAJES (FALTABA) -->
        <div id="travelsListScreen" class="screen hidden">
            <div class="app-header">
                <div class="header-content">
                    <button class="back-btn" onclick="showScreen('mainScreen')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">
                        <h1><i class="fas fa-list-ol"></i> Lista de Viajes</h1>
                        <p>Gestionar viajes registrados</p>
                    </div>
                </div>
            </div>

            <div class="form-container fade-in-up">
                <div id="travelsList">
                    <div style="text-align: center; padding: 40px; color: var(--cot-gris);">
                        <i class="fas fa-route" style="font-size: 3em; margin-bottom: 15px;"></i>
                        <p>No hay viajes registrados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANTALLA LISTA DE GUARDIAS (FALTABA) -->
        <div id="guardsListScreen" class="screen hidden">
            <div class="app-header">
                <div class="header-content">
                    <button class="back-btn" onclick="showScreen('mainScreen')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">
                        <h1><i class="fas fa-clipboard-list"></i> Lista de Guardias</h1>
                        <p>Gestionar guardias registradas</p>
                    </div>
                </div>
            </div>

            <div class="form-container fade-in-up">
                <div id="guardsList">
                    <div style="text-align: center; padding: 40px; color: var(--cot-gris);">
                        <i class="fas fa-user-clock" style="font-size: 3em; margin-bottom: 15px;"></i>
                        <p>No hay guardias registradas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PRECIO POR KIL√ìMETRO
        const PRICE_PER_KM = 7.60;
        
        // DATOS EN LOCALSTORAGE
        let travels = JSON.parse(localStorage.getItem('bus_travels')) || [];
        let guards = JSON.parse(localStorage.getItem('bus_guards')) || [];

        // NAVEGACI√ìN ENTRE PANTALLAS
        function showScreen(screenId) {
            // Ocultar todas las pantallas
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
                screen.classList.add('hidden');
            });
            
            // Mostrar la pantalla seleccionada
            const targetScreen = document.getElementById(screenId);
            targetScreen.classList.remove('hidden');
            targetScreen.classList.add('active');
            
            // Actualizar datos si es necesario
            if (screenId === 'mainScreen') {
                updateMainStats();
            }
            if (screenId === 'summaryScreen') {
                updateSummary();
            }
            if (screenId === 'travelsListScreen') {
                renderTravels();
            }
            if (screenId === 'guardsListScreen') {
                renderGuards();
            }
        }

        // CONFIGURACI√ìN INICIAL
        document.addEventListener('DOMContentLoaded', function() {
            updateMainStats();
            updateSummary();
            
            // Configurar fecha actual por defecto
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaViaje').value = hoy;
            document.getElementById('fechaGuardia').value = hoy;
            
            // Event listeners para botones de fecha r√°pida
            document.querySelectorAll('.btn-date').forEach(boton => {
                boton.addEventListener('click', function() {
                    const dias = parseInt(this.getAttribute('data-dias'));
                    const target = this.getAttribute('data-target');
                    const fecha = new Date();
                    fecha.setDate(fecha.getDate() + dias);
                    const fechaFormateada = fecha.toISOString().split('T')[0];
                    document.getElementById(target).value = fechaFormateada;
                });
            });
        });

        // FUNCI√ìN PARA ACTUALIZAR ESTAD√çSTICAS PRINCIPALES
        function updateMainStats() {
            const totalWorking = travels.filter(t => t.type === 'working').reduce((sum, t) => sum + t.km, 0);
            const totalPassenger = travels.filter(t => t.type === 'passenger').reduce((sum, t) => sum + t.km, 0);
            const totalGuards = guards.reduce((sum, g) => sum + parseFloat(g.km), 0);
            const totalAll = totalWorking + totalPassenger + totalGuards;
            const totalMoney = totalAll * PRICE_PER_KM;

            document.getElementById('mainTotalKm').textContent = totalAll.toFixed(0);
            document.getElementById('mainTotalMoney').textContent = `$${totalMoney.toFixed(0)}`;
            document.getElementById('mainTotalTravels').textContent = travels.length;
        }

        // FUNCI√ìN PARA ACTUALIZAR RESUMEN
        function updateSummary() {
            const totalWorking = travels
                .filter(travel => travel.type === 'working')
                .reduce((sum, travel) => sum + travel.km, 0);
                
            const totalPassenger = travels
                .filter(travel => travel.type === 'passenger')
                .reduce((sum, travel) => sum + travel.km, 0);
                
            const totalGuards = guards.reduce((sum, guard) => sum + parseFloat(guard.km), 0);
            
            const totalAll = totalWorking + totalPassenger + totalGuards;
            const totalMoney = totalAll * PRICE_PER_KM;

            document.getElementById('totalWorking').textContent = totalWorking.toFixed(1);
            document.getElementById('totalPassenger').textContent = totalPassenger.toFixed(1);
            document.getElementById('totalGuards').textContent = totalGuards.toFixed(1);
            document.getElementById('totalAll').textContent = totalAll.toFixed(1);
            document.getElementById('totalMoney').textContent = totalMoney.toFixed(2);
        }

        // FUNCI√ìN AGREGAR VIAJE
        function addTravel() {
            const orderNumber = document.getElementById('orderNumber').value;
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const km = parseFloat(document.getElementById('km').value);
            const travelType = document.getElementById('travelType').value;
            const departureTime = document.getElementById('departureTime').value;
            const arrivalTime = document.getElementById('arrivalTime').value;

            const fechaInput = document.getElementById('fechaViaje').value;
            let fechaViaje;

            if (fechaInput) {
                const [a√±o, mes, dia] = fechaInput.split('-');
                fechaViaje = `${dia}/${mes}/${a√±o}`;
            } else {
                fechaViaje = new Date().toLocaleDateString('es-ES');
            }

            if (!orderNumber || !origin || !destination || !km) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }

            const travel = {
                id: Date.now(),
                orderNumber,
                origin,
                destination,
                km,
                type: travelType,
                departureTime,
                arrivalTime,
                date: fechaViaje,
                timestamp: new Date().toISOString()
            };

            travels.push(travel);
            localStorage.setItem('bus_travels', JSON.stringify(travels));
            
            // Limpiar formulario
            document.getElementById('orderNumber').value = '';
            document.getElementById('origin').value = '';
            document.getElementById('destination').value = '';
            document.getElementById('km').value = '';
            document.getElementById('departureTime').value = '';
            document.getElementById('arrivalTime').value = '';
            
            updateMainStats();
            updateSummary();
            alert('‚úÖ Viaje agregado correctamente!');
        }

        // FUNCI√ìN AGREGAR GUARDIA
        function addGuard() {
            const guardType = document.getElementById('guardType').value;
            const guardStart = document.getElementById('guardStart').value;
            const guardEnd = document.getElementById('guardEnd').value;

            const fechaInput = document.getElementById('fechaGuardia').value;
            let fechaGuardia;

            if (fechaInput) {
                const [a√±o, mes, dia] = fechaInput.split('-');
                fechaGuardia = `${dia}/${mes}/${a√±o}`;
            } else {
                fechaGuardia = new Date().toLocaleDateString('es-ES');
            }

            if (!guardStart || !guardEnd) {
                alert('Por favor ingresa horario de inicio y fin');
                return;
            }

            const start = new Date(`2000-01-01T${guardStart}`);
            const end = new Date(`2000-01-01T${guardEnd}`);
            
            let hoursWorked = (end - start) / (1000 * 60 * 60);
            if (hoursWorked < 0) {
                hoursWorked += 24;
            }

            if (hoursWorked <= 0) {
                alert('La hora de fin debe ser posterior a la hora de inicio');
                return;
            }

            const kmPerHour = guardType === 'common' ? 30 : 40;
            const totalKm = hoursWorked * kmPerHour;

            const guard = {
                id: Date.now(),
                type: guardType,
                startTime: guardStart,
                endTime: guardEnd,
                hours: hoursWorked.toFixed(2),
                km: totalKm.toFixed(1),
                date: fechaGuardia
            };

            guards.push(guard);
            localStorage.setItem('bus_guards', JSON.stringify(guards));
            
            document.getElementById('guardStart').value = '';
            document.getElementById('guardEnd').value = '';
            
            updateMainStats();
            updateSummary();
            alert('‚úÖ Guardia agregada correctamente!');
        }

        // FUNCI√ìN MOSTRAR VIAJES
        function renderTravels() {
            const travelsList = document.getElementById('travelsList');
            travelsList.innerHTML = '';

            if (travels.length === 0) {
                travelsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--cot-gris);">
                        <i class="fas fa-route" style="font-size: 3em; margin-bottom: 15px;"></i>
                        <p>No hay viajes registrados</p>
                    </div>
                `;
                return;
            }

            const sortedTravels = [...travels].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedTravels.forEach(travel => {
                const travelItem = document.createElement('div');
                travelItem.className = 'list-item';
                travelItem.style.borderLeftColor = travel.type === 'working' ? 'var(--cot-azul)' : 'var(--cot-rojo)';
                
                let timeInfo = '';
                if (travel.departureTime || travel.arrivalTime) {
                    timeInfo = `<br><small>${travel.departureTime ? `üïí Salida: ${travel.departureTime}` : ''} ${travel.arrivalTime ? `Llegada: ${travel.arrivalTime}` : ''}</small>`;
                }
                
                travelItem.innerHTML = `
                    <div class="list-item-header">
                        <div class="list-item-title">
                            üöå Orden #${travel.orderNumber} - ${travel.date}
                        </div>
                        <div class="list-item-actions">
                            <button onclick="deleteTravel(${travel.id})" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                    <div style="color: var(--cot-gris); margin-bottom: 8px;">
                        üìç ${travel.origin} ‚Üí ${travel.destination}
                    </div>
                    <div style="font-weight: 600; color: var(--cot-azul);">
                        ${travel.km} km ‚Ä¢ ${travel.type === 'working' ? 'üöö Trabajando' : 'üë• Pasajero'}
                    </div>
                    ${timeInfo}
                `;
                travelsList.appendChild(travelItem);
            });
        }

        // FUNCI√ìN MOSTRAR GUARDIAS
        function renderGuards() {
            const guardsList = document.getElementById('guardsList');
            guardsList.innerHTML = '';

            if (guards.length === 0) {
                guardsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--cot-gris);">
                        <i class="fas fa-user-clock" style="font-size: 3em; margin-bottom: 15px;"></i>
                        <p>No hay guardias registradas</p>
                    </div>
                `;
                return;
            }

            guards.forEach(guard => {
                const guardItem = document.createElement('div');
                guardItem.className = 'list-item';
                guardItem.style.borderLeftColor = guard.type === 'common' ? 'var(--cot-azul)' : 'var(--cot-rojo)';
                
                guardItem.innerHTML = `
                    <div class="list-item-header">
                        <div class="list-item-title">
                            ‚è∞ ${guard.type === 'common' ? 'Guardia Com√∫n' : 'Guardia Especial'} - ${guard.date}
                        </div>
                        <div class="list-item-actions">
                            <button onclick="deleteGuard(${guard.id})" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                    <div style="color: var(--cot-gris); margin-bottom: 8px;">
                        üïí ${guard.startTime} - ${guard.endTime} (${guard.hours} horas)
                    </div>
                    <div style="font-weight: 600; color: var(--cot-azul);">
                        ${guard.km} km calculados
                    </div>
                `;
                guardsList.appendChild(guardItem);
            });
        }

        // [RESTANTE DE LAS FUNCIONES: deleteTravel, deleteGuard, mostrarReporteHoy, mostrarReporteMes, exportData, clearMonth]
        // Estas funciones se mantienen igual que en el c√≥digo anterior

    </script>
</body>
</html>

















